# Splunk Security Event Hunt: Monitoring Critical Windows Event Codes

## Description

This Splunk search is designed to identify and monitor significant Windows event logs to detect potential security incidents, including suspicious logins, account modifications, privilege escalations, logon failures, and firewall-related activities. By analyzing various event codes generated by Windows systems, this search aims to provide insights into system behavior, helping administrators and security analysts pinpoint areas of concern and potential threats in their environment.

## Value of the Hunt

This search provides critical visibility into **Windows event logs** that may indicate a **security breach** or an ongoing attack. By focusing on key event codes related to **logon attempts**, **account modifications**, **privilege escalation**, **password changes**, and **firewall activity**, this query helps security professionals quickly identify potential threats in their environment. Here's how it works:

- **Detect Unusual Activity**: Detects **failed login attempts**, which may indicate a **brute force attack** or **credential stuffing** (Event Codes 4625, 529, 530).
- **Identify Privilege Escalation**: Monitors for **privilege escalation** (Event Code 4672), a common tactic for attackers attempting to gain higher access.
- **Audit System Changes**: Tracks changes in **firewall settings** and **account modifications**, helping to ensure only authorized personnel are modifying sensitive system configurations (e.g., Event Codes 4946, 4697).
- **Detect Account Misuse**: Identifies suspicious activities related to **account unlocks** or **account modifications**, providing insight into potential malicious behavior (e.g., Event Code 4738, 4767).


## Explanation

- **EventCode Filtering in Splunk**: The search uses **eval** to categorize **Windows Event Codes** into logical labels, such as **"Logon Attempt"**, **"Account Modification"**, and **"Privilege Escalation"**. This allows security analysts to easily interpret logs and detect potential incidents in the data.
  
- **Aggregating Data with Splunk Stats Command**: The **stats** command aggregates data by **event code**, counting occurrences and grouping related information such as **users**, **source machines**, and **destination addresses**. This helps to uncover common patterns of activity and identify potential security incidents based on event frequency.

- **Sorting the Events by Count**: The `sort count` helps prioritize **high-frequency events**, allowing analysts to focus on the most critical and frequent incidents first.

- **Comprehensive Monitoring**: By including a wide range of event codes, this query provides comprehensive monitoring across various vectors, from **user authentication** and **privilege escalation** to **firewall manipulation** and **system configuration changes**.


## Conclusion

This search is an essential tool for security analysts and administrators working in environments with Windows systems. It helps highlight potential security threats, enabling a proactive approach to monitoring and incident response. Whether youâ€™re concerned about unauthorized access attempts, privilege escalation, or malicious changes to system configurations, this search can help uncover the necessary data for further investigation.

## Reference
https://www.xplg.com/windows-server-security-events-list/


## Search Query

```spl
index=windows
	| eval Events=case(EventCode=4648, "A logon attempt was made with explicit credentials", 
        EventCode=4670, "Permission on an object was changed", 
        EventCode=516, "Audit Logs Modified",
        EventCode=517, "Audit Logs Modified",
        EventCode=612, "Audit Logs Modified",
        EventCode=623, "Audit Logs Modified",
        EventCode=806, "Audit Logs Modified",
        EventCode=807, "Audit Logs Modified",
        EventCode=1101, "Audit Logs Modified",
        EventCode=1102, "Audit Logs Modified",
        EventCode=4612, "Audit Logs Modified",
        EventCode=4621, "Audit Logs Modified",
        EventCode=4694, "Audit Logs Modified",
        EventCode=4695, "Audit Logs Modified",
        EventCode=4715, "Audit Logs Modified",
        EventCode=4719, "Audit Logs Modified",
        EventCode=4817, "Audit Logs Modified",
        EventCode=4885, "Audit Logs Modified",
        EventCode=4902, "Audit Logs Modified",
        EventCode=4906, "Audit Logs Modified",
        EventCode=4907, "Audit Logs Modified",
        EventCode=4912, "Audit Logs Modified", 
        EventCode=642, "Account Modification",
        EventCode=646, "Account Modification",
        EventCode=685, "Account Modification",
        EventCode=4738, "Account Modification",
        EventCode=4742, "Account Modification",
        EventCode=4781, "Account Modification", 
        EventCode=1102, "Audit Logs Cleared/Deleted",
        EventCode=517, "Audit Logs Cleared/Deleted", 
        EventCode=628, "Passwords Changed",
        EventCode=627, "Passwords Changed",
        EventCode=4723, "Passwords Changed",
        EventCode=4724, "Passwords Changed",
        EventCode=528, "Successful Logons",
        EventCode=540, "Successful Logons",
        EventCode=4624, "Successful Logons", 
        EventCode=4625, "Failed Logons",
        EventCode=529, "Failed Logons",
        EventCode=530, "Failed Logons",
        EventCode=531, "Failed Logons",
        EventCode=532, "Failed Logons",
        EventCode=533, "Failed Logons",
        EventCode=534, "Failed Logons",
        EventCode=535, "Failed Logons",
        EventCode=536, "Failed Logons",
        EventCode=537, "Failed Logons",
        EventCode=539, "Failed Logons", 
        EventCode=576, "Escalation of Privileges",
        EventCode=4672, "Escalation of Privileges",
        EventCode=577, "Escalation of Privileges",
        EventCode=4673, "Escalation of Privileges",
        EventCode=578, "Escalation of Privileges",
        EventCode=4674, "Escalation of Privileges", 
        EventCode=4634, "An account was logged off", 
        EventCode=5140, "Application Error", 
        EventCode=4964, "A special group has been assigned to a new log on", 
        EventCode=4728, "A user was added to a privileged global group", 
        EventCode=4732, "A user was added to a privileged local group", 
        EventCode=4756, "A user was added to a privileged universal group", 
        EventCode=4740, "A user account was locked out", 
        EventCode=4767, "A user account was unlocked", 
        EventCode=4772, "A Kerberos authentication ticket request failed", 
        EventCode=4777, "The domain controller failed to validate the credentials of an account", 
        EventCode=4782, "Password hash an account was accessed", 
        EventCode=4657, "A registry value was changed", 
        EventCode=4697, "An attempt was made to install a service", 
        EventCode=4698, "Scheduled tasks", 
        EventCode=4699, "Scheduled tasks", 
        EventCode=4700, "Scheduled tasks", 
        EventCode=4701, "Scheduled tasks", 
        EventCode=4702, "Scheduled tasks", 
        EventCode=4946, "A rule was added to the Windows Firewall exception list", 
        EventCode=4947, "A rule was modified in the Windows Firewall exception list", 
        EventCode=4950, "A setting was changed in Windows Firewall", 
        EventCode=4954, "Group Policy settings for Windows Firewall has changed", 
        EventCode=5025, "The Windows Firewall service has been stopped", 
        EventCode=5031, "Windows Firewall blocked an application from accepting incoming traffic", 
        EventCode=5152, "A network packet was blocked by Windows Filtering Platform", 
        EventCode=5153, "A network packet was blocked by Windows Filtering Platform", 
        EventCode=5155, "Windows Filtering Platform blocked an application or service from listening on a port", 
        EventCode=5157, "Windows Filtering Platform blocked a connection", 
        EventCode=5447, "A Windows Filtering Platform filter was changed", 
        EventCode=4735, "A security-enabled local group was changed", 
        EventCode=4688, "New Process has been created"
    )
| stats values(user) as Users values(ComputerName) as Source values(dest) as destination count by Events
| stats values
| sort count

